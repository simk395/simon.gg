<img src="/game-bg.jpg" class="game-bg">

<% n = 0 %>
<% players_names = [] %>
<% @game.single_game["participantIdentities"].map do |player| %>
<% players_names << player["player"]["summonerName"]  %>
<% end %>
<% @stats_arr = [] %>
<% @game.single_game["participants"].each do |player| %>
<%# "team id" player["teamId"] %>
<% players_hash = {} %>
<% players_hash["name"] = players_names[n]%>
<% players_hash["rank"] = player['highestAchievedSeasonTier'] %>
<% players_hash["team"] = player["teamId"] %>
<% players_hash["damage"] = player["stats"]["totalDamageDealt"] %>
<% players_hash["kills"] = player["stats"]["kills"] %>
<% players_hash["deaths"] = player["stats"]["deaths"] %>
<% players_hash["assists"] = player["stats"]["assists"] %>

<% @stats_arr << players_hash %>
<% n = n+1 %>
<% end %>

<% def rank(n) %>
<% if @stats_arr[n]["rank"] == "BRONZE" %>
<%= image_tag("/ranks/BRONZE.png", class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "SILVER"%>
<%= image_tag("/ranks/SILVER.png",class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "GOLD"%>
<%= image_tag("/ranks/GOLD.png",class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "PLATINUM"%>
<%= image_tag("/ranks/PLATINUM.png",class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "DIAMOND"%>
<%= image_tag("/ranks/DIAMOND.png",class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "MASTER"%>
<%= image_tag("/ranks/MASTER.png",class: "game-rank") %>
<% elsif @stats_arr[n]["rank"] == "CHALLENGER"%>
<%= image_tag("/ranks/CHALLENGER.png",class: "game-rank") %>
<% end%>
<% end%>

<% def stats(n) %>
<p class="game-player-stat">Damage:
  <%= @stats_arr[n]["damage"] %>
</p>
<p class="game-player-stat">Kills:
  <%= @stats_arr[n]["kills"] %>
</p>
<p class="game-player-stat">Deaths:
  <%= @stats_arr[n]["deaths"] %>
</p>
<p class="game-player-stat">Assists:
  <%= @stats_arr[n]["assists"] %>
</p>
<% kda = ((@stats_arr[n]["kills"]+@stats_arr[n]["assists"]).to_f/@stats_arr[n]["deaths"]).round(2) %>
<% if @stats_arr[n]["kills"] > 1 && @stats_arr[n]["deaths"] == 0%>
<p class="game-player-kda-perfect"><%= kda %></p>
<% elsif kda < 1 %>
<p class="game-player-kda-bad"><%= kda %>
<% elsif kda >= 1 && kda < 3%>
<p class="game-player-kda-avg"><%= kda %>
<% elsif kda >= 3 && kda < 4%>
<p class="game-player-kda-good"><%= kda %>
<% elsif kda >= 4%>
<p class="game-player-kda-gg"><%= kda %>
<% end%>
<% end%>

  <div class="red">
    <div class="player1">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[0]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[0]%>_0.jpg" class="loading-art" alt="">
        <%= rank(0) %>
      </div>
      <div class="game-stats">
        <%= stats(0) %>
      </div>
    </div>
    <div class="player2">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[1]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[1]%>_0.jpg" alt="" class="loading-art">
        <%= rank(1) %>
      </div>
      <div class="game-stats">
        <%=stats(1)%>
      </div>
    </div>

    <div class="player3">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[2]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[2]%>_0.jpg" class="loading-art" alt="">
        <%= rank(2) %>
      </div>
      <div class="game-stats">
        <%= stats(2) %>
      </div>
    </div>

    <div class="player4">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[3]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[3]%>_0.jpg" class="loading-art" alt="">
        <%= rank(3) %>
      </div>
      <div class="game-stats">
        <%= stats(3) %>
      </div>
    </div>

    <div class="player5">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[4]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[4]%>_0.jpg" class="loading-art" alt="">
        <%= rank(4) %>
      </div>
      <div class="game-stats">
        <%= stats(4) %>
      </div>
    </div>
  </div>

  <div class="blue">
    <div class="player6">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[5]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[5]%>_0.jpg" class="loading-art" alt="">
        <%= rank(5) %>
      </div>
      <div class="game-stats">
        <%= stats(5) %>
      </div>
    </div>
    <div class="player7">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[6]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[6]%>_0.jpg" alt="" class="loading-art">
        <%= rank(6) %>
      </div>
      <div class="game-stats">
        <%=stats(6)%>
      </div>
    </div>

    <div class="player8">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[7]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[7]%>_0.jpg" class="loading-art" alt="">
        <%= rank(7) %>
      </div>
      <div class="game-stats">
        <%= stats(7) %>
      </div>
    </div>

    <div class="player9">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[8]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[8]%>_0.jpg" class="loading-art" alt="">
        <%= rank(8) %>
      </div>
      <div class="game-stats">
        <%= stats(8) %>
      </div>
    </div>

    <div class="player10">
      <div class="loading">
        <p class="game-name">
          <%= @stats_arr[9]["name"] %>
        </p>
        <img src="/images/champion_loading_art/<%= @champions[9]%>_0.jpg" class="loading-art" alt="">
        <%= rank(9) %>
      </div>
      <div class="game-stats">
        <%= stats(9) %>
      </div>
    </div>
  </div>